#!/bin/bash
# Permet de configurer l'interface de l'interface créer par lxc-net
#
# usage: tarr-steps [OPTIONS] [VALEUR]
#
# OPTIONS
#
#     -h, --help           affiche ce message d'aide
#     -ip, --ip            change l'adresse ip du switch
#     -p, --plage          permet de modifier la plage d'adresse attribuer aux machines
#     -n, --nombre         modifie le nombre d'IP maximum au sein du réseau
#     -l, --liste          liste les informations liées au switch
#     -c, --check          vérifie que l'interface tap a bien été créer
#

IP="LXC_ADDR="
PLAGE="LXC_DHCP_RANGE="
NBIP="LXC_DHCP_MAX="
NETMASK="LXC_NETMASK="
NETWORK="LXC_NETWORK="
toto=$(ip a | grep tap0 | egrep -c "vswitch0|master")
change (){ sed -i "s@$1\".*\"@$1\"$2\"@g" "/etc/default/lxc-net" ; }
doc(){ sed -n '2,/^$/ { s/^ *#// ; s/^ //g ; t ok ; d ; :ok ; p }' <$0 ; }
check(){ 
if($toto -eq 1)
then 
	echo "Votre interface tap0 a bien été créée"
else
	echo "Votre interface fait des siennes"
fi
}
while [ ! -z "$1" ] ;
do
    case "$1" in
        "-h"|"--help") doc && exit ;;
		"-ip"|"--ip") change $IP $2 && exit ;;
		"-p"|"--plage") change $PLAGE $2 && exit ;;
		"-n"|"--nombre") change $NBIP $2 && exit ;;
        "-l"|"--list") cat /etc/default/lxc-net && exit ;;
        "-c"|"--check") check && exit ;;
        *) break;;
    esac
    shift
done